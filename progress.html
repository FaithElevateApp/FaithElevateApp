<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Faith Elevate Progress</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .challenge-progress-table {
      width: 100%;
      border-collapse: collapse;
      background: #1e293b;
      color: #f8fafc;
      margin-bottom: 30px;
    }
    .challenge-progress-table th, .challenge-progress-table td {
      padding: 10px;
      border-bottom: 1px solid #334155;
      text-align: left;
    }
    .challenge-progress-table th {
      background: #334155;
    }
    .notes-list {
      background: #16213a;
      border-radius: 6px;
      padding: 10px 12px;
      margin: 8px 0 12px 0;
      font-size: 0.98em;
    }
    .notes-list li {
      margin-bottom: 6px;
      border-bottom: 1px solid #334155;
      padding-bottom: 4px;
    }
    .progress-bar-bg {
      background: #16213a;
      border-radius: 5px;
      height: 18px;
      width: 100%;
      position: relative;
      margin-top: 4px;
      margin-bottom: 4px;
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #38bdf8, #0ea5e9);
      border-radius: 5px;
      transition: width 0.5s ease-in-out;
    }
    .progress-bar-text {
      position: absolute;
      left: 50%;
      top: 0;
      transform: translateX(-50%);
      color: #38bdf8;
      font-weight: bold;
      font-size: 0.95em;
      line-height: 18px;
    }
    .challenge-graph-canvas {
      max-width: 350px;
      margin: 10px 0 20px 0;
      background: #0f172a;
      border-radius: 8px;
      padding: 8px;
    }
    .menu-container {
      position: absolute;
      top: 20px;
      right: 20px;
      cursor: pointer;
    }
    .menu-icon {
      width: 30px;
      height: 25px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }
    .menu-icon div {
      width: 100%;
      height: 3px;
      background-color: #38bdf8;
      transition: 0.3s;
    }
    .menu-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background-color: #1e293b;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 1000;
    }
    .menu-dropdown a {
      color: #f8fafc;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      transition: background-color 0.3s;
    }
    .menu-dropdown a:hover {
      background-color: #334155;
    }
    .menu-container:hover .menu-dropdown {
      display: flex;
    }
  </style>
</head>
<body>
  <!-- Standard Header -->
  <header>
    <h1>Faith Elevate</h1>
    <div class="menu-container">
      <div class="menu-icon">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="menu-dropdown">
        <a href="#" id="profile-menu-link">Profile</a>
        <a href="#">Settings</a>
        <a href="#">Help</a>
        <a id="logout-menu-item" href="#">Log Out</a>
      </div>
    </div>
    
    <script>
  // Highlight the current page and show live indicator
  document.addEventListener('DOMContentLoaded', function() {
    const page = location.pathname.split('/').pop().replace('.html','').toLowerCase();
    const map = {
      home: 'dashboard-home',
      library: 'dashboard-library',
      progress: 'dashboard-progress',
      reflections: 'dashboard-reflections',
      vod: 'dashboard-vod',
      reminder: 'dashboard-reminder',
      chalshare: 'dashboard-share',
      custom: 'dashboard-custom',
      archive: 'dashboard-archive',
      profile: 'dashboard-profile'
    };
    Object.keys(map).forEach(key => {
      const el = document.getElementById(map[key]);
      if (el) el.classList.remove('active');
    });
    if (map[page]) {
      const el = document.getElementById(map[page]);
      if (el) {
        el.classList.add('active');
        // Add live indicator
        if (!el.querySelector('.live-indicator')) {
          const live = document.createElement('span');
          live.className = 'live-indicator';
          el.appendChild(live);
        }
      }
    }
  });
    document.addEventListener('DOMContentLoaded', function() {
    const page = location.pathname.split('/').pop().replace('.html','').toLowerCase();
    const map = {
      index: 'dashboard-home',
      home: 'dashboard-home',
      library: 'dashboard-library',
      progress: 'dashboard-progress',
      reflections: 'dashboard-reflections',
      vod: 'dashboard-vod',
      reminder: 'dashboard-reminder',
      chalshare: 'dashboard-share',
      custom: 'dashboard-custom',
      archive: 'dashboard-archive',
      profile: 'dashboard-profile'
    };
    Object.keys(map).forEach(key => {
      const el = document.getElementById(map[key]);
      if (el) el.classList.remove('active');
    });
    // Support index.html as home
    let pageKey = page === "" ? "index" : page;
    if (map[pageKey]) {
      const el = document.getElementById(map[pageKey]);
      if (el) {
        el.classList.add('active');
        // Add live indicator
        if (!el.querySelector('.live-indicator')) {
          const live = document.createElement('span');
          live.className = 'live-indicator';
          el.appendChild(live);
        }
      }
    }
  });

</script>
    <nav>
      <ul>
        
         <a href="index.html" class="dashboard-link" id="dashboard-home">Home</a>
  <a href="library.html" class="dashboard-link" id="dashboard-library">Challenge Library</a>
  <a href="progress.html" class="dashboard-link" id="dashboard-progress">Progress Tracker</a>
  <a href="reflections.html" class="dashboard-link" id="dashboard-reflections">Reflections</a>
  <a href="VOD.html" class="dashboard-link" id="dashboard-vod">Verse of the Day</a>

  <a href="chalShare.html" class="dashboard-link" id="dashboard-share">Sharing</a>
  <a href="custom.html" class="dashboard-link" id="dashboard-custom">Custom Challenge</a>
  <a href="archive.html" class="dashboard-link" id="dashboard-archive">Achievements</a>
  <a href="#" class="dashboard-link" id="dashboard-profile">Profile</a>
      </ul>
    </nav>
  </header>

  <main style="max-width:1000px;margin:30px auto 40px auto;">
    <h2 style="color:#38bdf8;">Your Challenge Progress & Notes</h2>
    <div id="progress-challenges-container"></div>
  </main>

  <!-- Standard Footer -->
  <footer>
    <div class="social-icons">
      <a href="#"><i class="fab fa-facebook-f"></i><span> Facebook</span></a>
      <a href="#"><i class="fab fa-instagram"></i><span> Instagram</span></a>
      <a href="#"><i class="fab fa-twitter"></i><span> Twitter</span></a>
      <a href="#"><i class="fab fa-youtube"></i><span> YouTube</span></a>
    </div>
    <p>&copy; 2025 Faith Elevate. All rights reserved.</p>
  </footer>

  <script>
    // --- Challenge Data (must match your library.js) ---
    const challenges = [
      // Only names are needed for progress page, but you can add more info if you want
      { name: "Seeking Godâ€™s Will Challenge" },
      { name: "Daily Gratitude Challenge" },
      { name: "Prayer Discipline Challenge" },
      { name: "Scripture Memorization Challenge" },
      { name: "Forgiveness Challenge" },
      { name: "Love in Action Challenge" },
      { name: "Humility and Servanthood Challenge" },
      { name: "Generosity Challenge" },
      { name: "Faith Over Fear Challenge" },
      { name: "Bible in a Month Challenge (Short Books)" },
      { name: "Sabbath Rest Challenge" },
      { name: "Bold Witnessing Challenge" },
      { name: "Fasting for Focus Challenge" },
      { name: "Taming the Tongue Challenge" },
      { name: "Worship First Challenge" },
      { name: "Identity in Christ Challenge" },
      { name: "Patience Challenge" },
      { name: "Faith Journal Challenge" },
      { name: "Obedience Challenge" },
      { name: "Stillness Challenge" },
      { name: "Inquiring of God Challenge" },
      { name: "Unlearning & Renewal Challenge" }
    ];

    // --- Helper functions for localStorage keys ---
    function getChallengeKey(name) {
      return name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    }
    function getNotes() {
      return JSON.parse(localStorage.getItem("challenge-notes") || "[]");
    }
    function getChallengeProgress(key) {
      const totalDays = Number(localStorage.getItem(`challenge-days-${key}`)) || 0;
      const completed = Number(localStorage.getItem(`challenge-completed-${key}`)) || 0;
      const percent = totalDays ? Math.round((completed / totalDays) * 100) : 0;
      return { totalDays, completed, percent };
    }
    function getChallengeReflections(key) {
      return JSON.parse(localStorage.getItem(`challenge-reflections-${key}`) || "[]");
    }

    // --- Render Progress Table ---
    function renderProgressPage() {
      const container = document.getElementById('progress-challenges-container');
      container.innerHTML = "";

      // Filter for challenges that have been started (have days set)
      const startedChallenges = challenges.filter(ch => {
        const key = getChallengeKey(ch.name);
        return Number(localStorage.getItem(`challenge-days-${key}`)) > 0;
      });

      if (!startedChallenges.length) {
        container.innerHTML = `<p style="color:#fbbf24;">You haven't started any challenges yet. Start one from the <a href="library.html" style="color:#38bdf8;">Challenge Library</a>!</p>`;
        return;
      }

      startedChallenges.forEach((ch, idx) => {
        const key = getChallengeKey(ch.name);
        const { totalDays, completed, percent } = getChallengeProgress(key);
        const reflections = getChallengeReflections(key);

        // Get notes for this challenge
        const notes = getNotes().filter(n => n.challenge === ch.name);

        // Progress bar HTML
        const progressBar = `
          <div class="progress-bar-bg" style="width:220px;">
            <div class="progress-bar-fill" style="width:${percent}%;"></div>
            <span class="progress-bar-text">${percent}%</span>
          </div>
        `;

        // Notes HTML
        let notesHtml = `<ul class="notes-list">`;
        if (notes.length) {
          notes.forEach(n => {
            notesHtml += `<li><strong>${n.date}:</strong> ${n.content}</li>`;
          });
        } else {
          notesHtml += `<li style="color:#94a3b8;">No notes yet for this challenge.</li>`;
        }
        notesHtml += `</ul>`;

        // Graph canvas
        const graphId = `challenge-graph-${key}`;

        // Reflection graph data (dates vs. engagement %)
        const labels = reflections.map(r => r.date);
        const data = reflections.map(r => r.percent);

        // Table for each challenge
        const challengeBlock = document.createElement('div');
        challengeBlock.style.background = "#0f172a";
        challengeBlock.style.borderRadius = "10px";
        challengeBlock.style.margin = "24px 0";
        challengeBlock.style.padding = "18px 20px";
        challengeBlock.innerHTML = `
          <h3 style="color:#38bdf8;">${ch.name}</h3>
          <table class="challenge-progress-table">
            <tr>
              <th>Total Days</th>
              <th>Completed Days</th>
              <th>Progress</th>
              <th>Graph</th>
            </tr>
            <tr>
              <td>${totalDays}</td>
              <td>${completed}</td>
              <td>${progressBar}</td>
              <td>
                <canvas id="${graphId}" class="challenge-graph-canvas" width="320" height="120"></canvas>
              </td>
            </tr>
          </table>
          <div>
            <strong style="color:#fbbf24;">Your Notes for this Challenge:</strong>
            ${notesHtml}
          </div>
        `;
        container.appendChild(challengeBlock);

        // Draw graph after DOM insert
        setTimeout(() => {
          const ctx = document.getElementById(graphId).getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [{
                label: 'Reflection Engagement (%)',
                data: data,
                fill: false,
                borderColor: '#38bdf8',
                backgroundColor: '#0ea5e9',
                tension: 0.2,
                pointRadius: 4,
                pointBackgroundColor: '#fbbf24'
              }]
            },
            options: {
              responsive: false,
              plugins: {
                legend: { display: false }
              },
              scales: {
                y: {
                  min: 0,
                  max: 100,
                  ticks: { color: '#f8fafc' },
                  grid: { color: '#334155' }
                },
                x: {
                  ticks: { color: '#f8fafc' },
                  grid: { color: '#334155' }
                }
              }
            }
          });
        }, 100);
      });
    }

    document.addEventListener('DOMContentLoaded', renderProgressPage);

    document.addEventListener('DOMContentLoaded', function() {
      const logoutMenuItem = document.getElementById('logout-menu-item');
      if (logoutMenuItem) {
        logoutMenuItem.addEventListener('click', function(event) {
          event.preventDefault();
          if (typeof signOut === "function") signOut();
        });
      }
      const profileMenuLink = document.getElementById('profile-menu-link');
      if (profileMenuLink && typeof showProfile === "function") {
        profileMenuLink.addEventListener('click', function(event) {
          event.preventDefault();
          showProfile();
        });
      }
    });
  </script>
</body>
</html>